functions:
  seaf.ta:
    get_refs: >
     (
      $component := $.c;
      $context := $lookup($.entities,$component).**."properties";
      $context.**."$ref".%;
      $context.$spread().{ 
      $keys()[0] : ($split($string($.**."$ref".%."$ref"),"/")[2])~>$replace(/^(.*)(\.\w+)$/,"$1") 
      }~>$merge();
     )
    get_titles: >
     (
            $component := $.c;
            $def := ($lookup($.entities, $component).schema.**."$ref"~>$map(
                     function($v){$contains($v, "def")?$v~>$replace(/.*\/(.*)/, "$1")}));
            $base_prop := $lookup($.entities.**, $def[0]).properties;
            $component_prop := $lookup($.entities, $component).schema.**.properties;     
            $titles := $merge(($merge([$component_prop, $base_prop])).$spread().{
                $keys()[0] : $.*.title ? $.*.title : $keys()[0]
             });
             $titles := $merge([$titles, {"type":"Тип", "server_id":"Сервер ID"}]);
             /*$titles := $spread($lookup($.entities, $component).schema.**."$ref"~>$map(function($v){
                     $contains($v, "def")?(
                         $a := $lookup($.entities.**, $v~>$replace(/.*\/(.*)/, "$1")).**."properties";
                         $type($a) = 'array'? $a:= $a[0] : $a;
                     )
             })){ $keys()[0] : $.*.title ? $.*.title : $keys()[0]};
             $titles := $merge([$titles, {"title":"Наименование", "type":"Тип", "description":"Описание"}]);*/
     )
    get_link: >
     (
       $href := $.hr;
       $v:=$.val;
       $type($v) = 'string'?
          $link := '/entities/' & $href & '/list?ta-component-id=' & $v:
       $type($v) = 'array'? 
          $count($v) >1?($link:=$v;$log("-+-> " & $link,["MTG"]);):$link :=  $map($v, function($val){'/entities/' & $href & '/list?ta-component-id=' & $val}):
          $link := $v;
          /*$log("-*-> "& $link,["MTG"]);*/
      )
