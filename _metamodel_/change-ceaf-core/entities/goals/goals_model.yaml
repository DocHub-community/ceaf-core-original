entities:  
  ceaf.change.goals:
    title: Модель управления целями
    description: >
      Модель управления целями
    schema:
      type: object
      patternProperties:
        "[a-zA-Z0-9_]*(\\.[a-zA-Z0-9_]*)*$":
          type: object
          properties:
            title:
              title: Название ADR
              type: string
            description:
              title: Краткое описание рассматриваемого архитектурного решения
              type: string
          required:
            - title
            - description

    objects:
      adrs:
        route: "/"
        title: ADR
        symbol: "do"


    menu: >
      (
          $adrs := $."ceaf.change.adrs";
          $makeLocation := function($id) {(
              $arrleft := function($arr ,$count) {
                  $map($arr, function($v, $i) {
                  $i <= $count ? $v
                  })
              };
              $domains := $split($id, ".");
              "Архитектура/ADRs/" & $join($map($domains, function($domain, $index) {(
                  $lookup($adrs, $join($arrleft($domains, $index), ".")).title
                  )}), "/");
          )};

          $append([{
              "icon": *.icon,
              "link": "entities/ceaf.change.adrs/adl",
              "location": "Архитектура/ADRs"
          }],
              [$."ceaf.change.adrs".$spread().{
                  "icon": *.icon,
                  "link": "entities/ceaf.change.adrs/" & (($.*.presentation) ? $.*.presentation : "adr") & "?id=" & $keys()[0],
                  "location": $makeLocation($keys()[0]),
                  "order": *.order
              }][location]
          );
      )


    presentations: 
      adl:
        type: table
        headers:
          - value: adr_id
            text: ID
            sortable: true
            align: left
            width: 10%
            link: link_to_adr

          - value: title
            text: Наименование
            sortable: true
            align: left
            width: 40%
            link: link_to_adr

          - value: status
            text: Статус
            sortable: true
            align: left
            width: 10%

          - value: date
            text: Дата
            sortable: true
            align: left

          - value: decision_level
            text: Уровень решения
            sortable: true
            align: left

          - value: doc_autor
            text: Автор решения
            sortable: true
            align: left

        source: >
          (
            $adrs := $."ceaf.change.adrs";
            [$adrs.$spread().(
              $adr_id:= $keys()[0];
              $adr:= $.*;
              {
                "adr_id": $adr_id,
                "link_to_adr": "adr?id=" & $adr_id,
                "title": $adr.title,                
                "status": $adr.status,
                "date": $adr.date,
                "decision_level": $adr.decision_level,
                "doc_autor": $adr.doc_autor
              };
            )];
          )

      adr:
        type: markdown
        title: Выводим карточку adr
        template: templates/adr_template.md
        source: >
          (
              $adr := [$."ceaf.change.adrs".$spread().$merge([$.*, {"id": $keys($)}])];
              $adr [id=$params.id];
          )