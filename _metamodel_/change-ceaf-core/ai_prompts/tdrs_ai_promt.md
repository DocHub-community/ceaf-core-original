# Инструкция по созданию TDR

## 1. Назначение
Данный файл содержит инструкции для AI-ассистента по созданию и заполнению TDR документа.
AI-ассистент должен четко придерживаться этих инструкций при выполнении своих задач.
В случае несоответствия инструкций, AI-ассистент должен остановить любые свои действия и запросить у пользователя дальнейшие инструкции.
AI-ассистент должен перейти к разделу 2 этой инструкции "Начало работы"

## 2. Начало работы

При начале работы с TDR документом, AI-ассистент должен понять, что хочет пользователь и если контекст непонятен, то предложить пользователю выбрать один из вариантов:
  1. Создать новый TDR документ
  2. Заполнить уже существующий TDR документ

Если пользователь выбрал вариант "Создать новый TDR документ" или AI-ассистент понял, что пользователь хочет создать новый TDR документ, то перейти к разделу 3 этой инструкции "Создание нового TDR документа"

Если пользователь выбрал вариант "Заполнить уже существующий TDR документ" или AI-ассистент понял, что пользователь хочет заполнить уже существующий TDR документ, то он обязательно должен выполнить следующие шаги:
  * Найти в директории `ceaf-core-original/arch_ceaf_example/change/tdrs/` все файлы с наиболее близким названием и описанием документа TDR
  * Обязательно вывести пользователю список найденных документов подходящих под описание документа TDR с ближайшей к текущей дате датой, но не менее чем за 7 дней до текущей даты, в формате: Номер по порядку: Название документа
  * Обязательно предложить пользователю выбрать номер документа из списка
  * Только после введения номера документа, открыть файл и предложить пользователю начать заполнять файл в соответствии с разделом 4 этой инструкции "Заполнение уже существующего TDR документа"

## 3. Создание нового TDR документа
При создании нового TDR документа, AI-ассистент должен:
1. Далее взять файл с базовой моделью TDR по ссылке:
    `ceaf-core-original/ceaf_doc/metamodel/change/tdrs/tdr_model.md`
2. Скопировать файл tdr_model.md в директории `ceaf-core-original/arch_ceaf_example/change/tdrs/`
3. Переименовать скопированный файл в соответствии следующими с требованиями:     
    * Полное имя файла должно быть в формате: `$(date +%Y-%m-%d)_краткое_описание_tdr.md`,
      где $(date +%Y-%m-%d) - текущая дата, которую нужно всегда брать из операционной системы пользователя, краткое_описание - краткое описание TDR, которое ввел пользователь должно быть на русском языке
4. Если при создании файла или его открытии возникла ошибка выполнить пункты из раздела 5 "Обработка ошибок при открытии или создании TDR документа" и только потом продолжить выполнение этого раздела
5. Перейти к разделу 4 этой инструкции "Заполнение уже существующего TDR документа" и остановить выполнение этого раздела

## 4. Заполнение уже существующего TDR документа
AI-ассистент обязательно должен остановить выполнение любых действий здесь.
AI-ассистент обязательно должен показать пользователю, что ты планируешь дальше делать.
AI-ассистент обязательно должен запросить подтверждение от пользователя, что можно продолжать выполнение этого раздела начиная с 1 пункта.

1. Перед дальнейшим заполнением TDR документа AI-ассистент обязательно должен выполнить проверку его структуры. Для этого нужно выполнить следующие шаги:
   - Шаг 1: AI-ассистент должен сравнить документ с базовой моделью, для этого требуется сделать следующее:
     * Взять все содержимое текущего TDR документа
     * Взять содержимое базовой модели расположенную по следующему пути: `ceaf-core-original/ceaf_doc/metamodel/change/tdrs/tdr_model.md`
     * Сделать сравнение всех заголовков загруженных документов на 100%-е совпадение по всем уровням (###, ####, etc.)
     * Сделать сравнение всех вопросов загруженных документов на 100%-е их совпадение друг с другом исключая маркеры "- ▢" и "- ▣" и ответы на вопросы находящиеся под этими маркерами. Для идентификации вопросов нужно использовать маркеры "- ▢" и/или "- ▣"
     * В случае обнаружения различий AI-ассистент обязательно должен перейти к Шагу 2 этого пункта
   - Шаг 2: Если в рамках шага 1 обнаружены различия, то AI-ассистент должен обязательно их обработать в соответствии с алгоритмом ниже. Без этого переходить к пункту 2 этого раздела нельзя:
     * При обнаружении изменений в TDR документе AI-ассистент должен показать в TDR документ изменения по сравнению с базовой моделью используя команду diff.
     * Далее AI-ассистент должен предложить пользователю 2 варианта действий:
        * Обновить базовую модель из текущего документа
        * Обновить текущий документ из базовой модели
    * Если пользователь выбирает вариант "Обновить базовую модель из текущего документа", то AI-ассистент должен:
        * Обновить базовую модель из текущего документа
        * Открыть файл и показать изменения пользователю, используя команду diff
        * Получить финальное подтверждение корректности структуры от пользователя
        * Если пользователь согласен с изменениями, то предложить ему сохранить файл
    * Если пользователь выбирает вариант "Обновить текущий документ из базовой модели", то AI-ассистент должен:
        * Обновить текущий документ из базовой модели
        * Открыть файл и показать изменения пользователю, используя команду diff  
        * Получить финальное подтверждение корректности структуры от пользователя
        * Если пользователь согласен с изменениями, то AI-ассистент должен предложить ему сохранить файл
    * Если пользователь не хочет вносить изменения, то AI-ассистент должен предложить ему перейти к заполнению документа в соответствии с разделом 4 этой инструкции "Заполнение уже существующего TDR документа"
2. AI-ассистент обязательно должен строго следовать алгоритму ниже при работе с вопросами TDR документа:
    * В TDR документах используются следующие маркеры, отклонения от которых недопустимы:
        * "- ▢" (дефис, пробел, пустой квадрат) - маркер неотвеченного вопроса
        * "- ▣" (дефис, пробел, заполненный квадрат) - маркер отвеченного вопроса
        * "  >" (два пробела, знак больше) - маркер ответа на вопрос
    * Найти первый неотвеченный вопрос в документе. Для этого нужно:
        1. Использовать команду grep для поиска точного совпадения маркера "- ▢" (дефис, пробел, квадрат)
        2. Из всех найденных результатов выбрать первый по порядку следования в документе
        3. Этот вопрос и будет первым неотвеченным вопросом    
        4. Обязательно проверить, что найденный вопрос действительно не имеет ответа, для этого:
           * Проверить отсутствие маркера ">" на следующей строке после вопроса
           * Проверить, что вопрос не помечен маркером "▣"
           * Если хотя бы одно условие не выполняется, вопрос считается отвеченным и нужно перейти к следующему вопросу с маркером "▢"
        5. Если после проверки оказалось, что вопрос уже отвечен, повторить шаги 1-4 для следующего вопроса с маркером "▢"
        6. Обязательно показать пользователю найденный неотвеченный вопрос и его контекст (несколько строк до и после)
    * Если не найдено вопросов с маркером ▢, то необходимо сказать пользователю, что документ заполнен и спросить что делать дальше. 
    * Если вопрос с маркером ▢ найден, то AI-ассистент должен взаимодействовать с пользователем по следующему алгоритму:
        1. Предложить пользователю ответить на первый неотвеченный вопрос обязательно необходимо учитывать рекомендации по заполнению TDR документа описанные в разделе 6 этой инструкции "Рекомендации по заполнению TDR документа"
        2. Если пользователь указал письменно что согласен отвечать на вопрос, то AI-ассистент должен предложить пользователю свой вариант ответа на вопрос
        3. Если пользователь письменно подтвердил, что согласен с предложенным вариантом ответа, то AI-ассистент должен предложить пользователю сохранить изменения в TDR документ по следующим правилам:
          * При замене маркера необходимо полностью удалить строку с маркером ▢ и заменить её на новую строку с маркером ▣ без изменения самого вопроса
          * Ответ на вопрос должен быть указан как комментарий к вопросу, используя маркер >
          * Ответ должен быть на новой строке сразу после строки с маркером ▣
          * Маркер > комментария ответа должен быть указан ровно под маркером ответа ▣ со сдвигом вправо на 2 пробела
          * Пример правильного форматирования:
            ```
            Было:
            - ▢ Вопрос?

            Стало:
            - ▣ Вопрос?
              > Ответ на вопрос
            ```
          * Любые отклонения от этого форматирования недопустимы и должны быть исправлены при обнаружении
        4. Если пользователь письменно подтвердил, что не согласен с предложенным вариантом ответа, то AI-ассистент должен предложить пользователю исправить ответ или предложить другой вариант ответа
        5. После этого AI-ассистент должен переформулировать ответ с учетом замечаний пользователя он должен запросить подтверждение от пользователя, что он согласен с предложенным вариантом исправления.
        6. Если пользователь письменно подтвердил, что согласен с предложенным вариантом исправления, то AI-ассистент должен предложить пользователю сохранить изменения в TDR документ по тем же правилам форматирования, что указаны в пункте 3
        7. После внесения ответа в документ, AI-ассистент должен предложить пользователю перейти к следующему неотвеченному вопросу и обязательно повторить шаги 1-7
        8. Алгоритм нужно повторять до тех пор, пока не будут отвечены все вопросы

## 5. Обработка ошибок при открытии или создании TDR документа:
   Если возникла ошибка чтения ошибке чтения:
     * Проверить существование файла
     * Проверить права доступа
     * Предложить альтернативный путь
   Если возникла ошибка записи:
     * Проверить блокировку файла
     * Проверить права на запись
     * Предложить сохранение во временный файл
   Если возник конфликт изменений:
     * Показать конфликтующие изменения
     * Предложить варианты разрешения
     * Дождаться решения пользователя

    После выполнения всех пунктов из раздела 5 "Обработка ошибок при открытии или создании TDR документа" нужно открыть TDR документ и предложить пользователю заполнить его в соответствии с разделом 4 этой инструкции "Заполнение уже существующего TDR документа"

## 6. Рекомендации по заполнению TDR документа

1. Критерии качества ответов:
   - Определение стейкхолдеров:
     * Указывать полное ФИО стейкхолдера
     * Определять конкретную роль в организации
     * Описывать область ответственности и влияния
     * Пример хорошего описания: "Иванов Иван Иванович - Руководитель отдела разработки, отвечает за техническую реализацию и качество кода"
     * Пример плохого описания: "Иванов - технический специалист"
   
   - Классификация стейкхолдеров:
     * Разделять на ключевых и обычных стейкхолдеров
     * Объяснять критерии выбора ключевого стейкхолдера
     * Описывать взаимосвязи между стейкхолдерами
     * Пример хорошего описания: "Ключевой стейкхолдер Петров П.П. (Владелец продукта) - принимает финальные решения по функциональности. Связанный стейкхолдер Сидоров С.С. (Технический архитектор) - отвечает за техническую реализацию решений"
     * Пример плохого описания: "Петров - ключевой, потому что главный"
   
   - Определение ролей и ответственности:
     * Четко описывать роль каждого стейкхолдера в проекте
     * Указывать конкретные области принятия решений
     * Определять уровень вовлеченности в процесс
     * Пример хорошего описания: "Роль: Технический архитектор. Ответственность: проектирование архитектуры, выбор технологий, согласование технических решений. Уровень вовлеченности: все этапы проекта"
     * Пример плохого описания: "Отвечает за техническую часть"

   - Конкретность и измеримость:
     * Использовать точные числовые показатели где возможно
     * Указывать конкретные сроки в формате YYYY-MM-DD
     * Определять измеримые критерии успеха
     * Пример хорошего ответа: "Снижение времени обработки на 40% (с 5 минут до 3 минут)"
     * Пример плохого ответа: "Значительное ускорение работы системы"
   
   - Ориентация на стейкхолдеров:
     * Явно указывать какие стейкхолдеры затронуты
     * Описывать влияние на каждую группу стейкхолдеров
     * Учитывать возможные конфликты интересов
     * Пример хорошего ответа: "Для разработчиков: уменьшение времени на развертывание. Для бизнеса: сокращение времени простоя"
     * Пример плохого ответа: "Улучшение для всех пользователей"

   - Связь с контекстом:
     * Ссылаться на конкретные части предыдущих ответов
     * Указывать зависимости между решениями
     * Объяснять как решение влияет на общую картину
     * Пример хорошего ответа: "Учитывая ограничения безопасности из раздела 2.3, предлагается..."
     * Пример плохого ответа: "Это решение учитывает все требования"

   - Проверяемость:
     * Определять конкретные критерии проверки
     * Указывать способы измерения результатов
     * Описывать процедуру валидации
     * Пример хорошего ответа: "Успешность подтверждается при: 1) времени ответа < 200мс, 2) доступности > 99.9%"
     * Пример плохого ответа: "Решение должно работать быстро и стабильно"

2. Учет российской специфики:
   - Законодательные требования РФ:
     * Проверять соответствие 152-ФЗ, 187-ФЗ и другим релевантным законам
     * Учитывать требования регуляторов (ЦБ, ФСТЭК, ФСБ)
     * Проверять требования к хранению и обработке данных
     * Пример: "Хранение персональных данных на серверах в РФ согласно 152-ФЗ"

   - Особенности российского рынка:
     * Учитывать доступность технологий и компонентов
     * Проверять наличие локальных аналогов
     * Оценивать стоимость в текущих условиях
     * Пример: "Использование российских облачных провайдеров: SberCloud, VK Cloud"

   - Культурные и организационные особенности:
     * Учитывать принятые практики в отрасли
     * Рассматривать особенности корпоративной культуры
     * Оценивать готовность к изменениям
     * Пример: "Поэтапное внедрение с обучением персонала на каждом этапе"

   - Технологические ограничения и возможности:
     * Проверять доступность технологий в РФ
     * Учитывать санкционные ограничения
     * Оценивать возможности импортозамещения
     * Пример: "Использование PostgreSQL вместо Oracle для обеспечения независимости"

3. Чего избегать:
   - Общих формулировок:
     * Не использовать: "улучшить", "оптимизировать", "повысить" без конкретных показателей
     * Не писать: "в ближайшее время", "скоро", "быстро" без точных сроков
     * Пример плохой формулировки: "Система должна работать быстрее"
     * Пример хорошей формулировки: "Время отклика должно быть не более 100мс"

   - Противоречий:
     * Проверять согласованность с предыдущими ответами
     * Выявлять конфликты с существующими решениями
     * При обнаружении противоречий - явно их обозначать и разрешать
     * Пример: "Данное решение требует изменения подхода, описанного в разделе X, потому что..."

   - Дублирования:
     * Не повторять информацию из других разделов
     * Использовать ссылки на существующие ответы
     * При необходимости повтора - объяснять причину
     * Пример: "Детали реализации описаны в разделе X, здесь рассматриваем только..."

   - Прямого копирования зарубежных практик:
     * Всегда адаптировать под российские реалии
     * Учитывать доступность технологий
     * Проверять применимость в текущих условиях
     * Пример: "Вместо решения X, недоступного в РФ, используем аналог Y с следующими адаптациями..."
